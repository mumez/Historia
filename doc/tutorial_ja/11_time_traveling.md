# タイムトラベル：過去の状態の探索

このフレームワークでは、イベントバージョン（タイムスタンプのようなもの）で識別される過去の任意の時点での ModelSpace の状態を簡単に「タイムトラベル」して表示することができます。これは`goTo:`メソッドを使用して行われます。

## タイムトラベルの仕組み

1. **イベントバージョンの取得**: まず、訪問したい時点に対応するイベントバージョンが必要です。最近のイベントバージョンのリストは`eventVersionsReversedFromLast:`を使用して取得できます。
2. **`goTo:`の使用**: 目的のイベントバージョンを ModelSpace インスタンスの`goTo:`メソッドに渡します。ModelSpace はその後、その特定のイベントが発生した*後*の状態に正確に戻ります。

## 例：口座履歴をたどる

`modelSpace2`の最近のイベントバージョンを取得してみましょう：

```Smalltalk
recentEventVersions := modelSpace2 eventVersionsReversedFromLast: 10. "print it"
```

これにより、以下のようなリストが得られるかもしれません（新しい順）：

```Smalltalk
an OrderedCollection('1744206010080-0' '1744206008674-0' '1744205251197-0'
'1744204797556-0' '1744204795460-0' '1744204795457-0')
```

では、異なる時点に移動してみましょう：

**1. 初期状態に移動（残高変更前）：**
最も古いイベントバージョンはリストの最後にあります。

```Smalltalk
modelSpace2 goTo: recentEventVersions last. "初期バージョンに移動"
modelSpace2 getBalanceAt: accId. "-> 0"
```

**2. 最新の状態に移動：**
最も新しいイベントバージョンはリストの最初にあります。

```Smalltalk
modelSpace2 goTo: recentEventVersions first. "最新バージョンに移動"
modelSpace2 getBalanceAt: accId. "-> 200"
```

**3. 中間状態に移動：**
イベント`'1744205251197-0'`が発生した後の状態（リストの 3 番目のイベントバージョン）に移動してみましょう。

```Smalltalk
modelSpace2 goTo: recentEventVersions third. "バージョン'1744205251197-0'に移動"
modelSpace2 getBalanceAt: accId. "-> 170"
```

このタイムトラベル機能は、デバッグ、監査、またはモデルの状態が時間とともにどのように進化したかを理解するのに非常に役立ちます。
内部的には、フレームワークはこのタイムトラベルプロセスを効率化しています。`goTo:`を使用する場合、最初からすべてのイベントを盲目的に再生するわけではありません。代わりに、まずターゲットイベントバージョン*以前*に保存された最新のスナップショットを特定して読み込みます。その後、そのスナップショットとターゲットイベントバージョンの*間*に発生したイベントのみを再生します。この「差分再生」により、特に大量の履歴イベントを扱う場合でも、復元プロセスが大幅に高速化され、`goTo:`が効率的に機能することが保証されます。
